<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>플래시카드</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 2rem;
    }
    #card {
      font-size: 2.5rem;
      padding: 2rem;
      border: 2px solid #888;
      display: inline-block;
      min-width: 200px;
      min-height: 100px;
      margin-bottom: 1rem;
    }
    #progress {
      margin: 1rem;
      font-size: 1.2rem;
    }
    #message {
      margin: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
      color: #d00;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 0.3rem;
    }
  </style>
</head>
<body>

  <h1>플래시카드</h1>

  <div id="progress">0 / 0</div>
  <div id="card">로딩 중...</div>
  <div id="message"></div>

  <div>
    <button onclick="prevCard()">⬅ 이전</button>
    <button onclick="speakCurrent()">🔊 다시 듣기</button>
    <button onclick="startSpeech()">🎤 정답 말하기</button>
    <button onclick="nextCard()">➡ 다음</button>
  </div>

  <script>
    const cards = [
      { front: "apple", back: "사과" },
      { front: "fish", back: "생선,물고기" },
      { front: "rice", back: "쌀,밥" },
      { front: "thirsty", back: "목마르다,목마른" },
      // 추가 가능
    ];

    let current = 0;

    // TTS 함수
    function speak(text, lang = "en-US") {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = 0.9;
      utterance.pitch = 1.0;

      const voices = speechSynthesis.getVoices();
      const voice = voices.find(v => v.lang === lang && v.name.includes("Google")) || voices.find(v => v.lang === lang);
      if (voice) utterance.voice = voice;

      speechSynthesis.speak(utterance);
    }

    function updateCard() {
      const cardEl = document.getElementById("card");
      const progressEl = document.getElementById("progress");
      const messageEl = document.getElementById("message");

      if (current < 0) current = 0;
      if (current >= cards.length) current = cards.length - 1;

      const card = cards[current];
      cardEl.textContent = card.front;
      progressEl.textContent = `${current + 1} / ${cards.length}`;
      messageEl.textContent = "";
    }

    function nextCard() {
      current++;
      if (current >= cards.length) current = 0;
      updateCard();
    }

    function prevCard() {
      current--;
      if (current < 0) current = 0;
      updateCard();
    }

    function speakCurrent() {
      speak(cards[current].front, "en-US");
    }

    function startSpeech() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("음성 인식이 이 브라우저에서 지원되지 않습니다.");
        return;
      }

      const recog = new webkitSpeechRecognition();
      recog.lang = "ko-KR";
      recog.interimResults = false;
      recog.maxAlternatives = 1;

      recog.onresult = function(event) {
        const said = event.results[0][0].transcript.trim();
        const correctAnswers = cards[current].back.split(",").map(s => s.trim());
        const isCorrect = correctAnswers.some(ans => said.includes(ans) || ans.includes(said));

        if (isCorrect) {
          showMessage(`✅ 정답! (${said})`);
        } else {
          showMessage(`❌ 오답! (${said})<br>👉 정답: ${cards[current].back}`);
        }

        setTimeout(() => {
          nextCard();
        }, 1500);
      };

      recog.onerror = function() {
        showMessage("🎤 음성 인식 실패. 다시 시도해 주세요.");
      };

      recog.start();
      speakCurrent();  // 말하고 인식 시작
    }

    function showMessage(msg) {
      document.getElementById("message").innerHTML = msg;
    }

    // 초기화
    window.onload = () => {
      // TTS 음성 로드 (Chrome에서 필수)
      speechSynthesis.getVoices();
      updateCard();
    };
  </script>

</body>
</html>
