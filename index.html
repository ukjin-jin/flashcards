<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í”Œë˜ì‹œì¹´ë“œ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 2rem;
    }
    #card {
      font-size: 2.5rem;
      padding: 2rem;
      border: 2px solid #888;
      display: inline-block;
      min-width: 200px;
      min-height: 100px;
      margin-bottom: 1rem;
    }
    #progress {
      margin: 1rem;
      font-size: 1.2rem;
    }
    #message {
      margin: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
      color: #d00;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      margin: 0.3rem;
    }
  </style>
</head>
<body>

  <h1>í”Œë˜ì‹œì¹´ë“œ</h1>

  <div id="progress">0 / 0</div>
  <div id="card">ë¡œë”© ì¤‘...</div>
  <div id="message"></div>

  <div>
    <button onclick="prevCard()">â¬… ì´ì „</button>
    <button onclick="speakCurrent()">ğŸ”Š ë‹¤ì‹œ ë“£ê¸°</button>
    <button onclick="startSpeech()">ğŸ¤ ì •ë‹µ ë§í•˜ê¸°</button>
    <button onclick="nextCard()">â¡ ë‹¤ìŒ</button>
  </div>

  <script>
    const cards = [
      { front: "apple", back: "ì‚¬ê³¼" },
      { front: "fish", back: "ìƒì„ ,ë¬¼ê³ ê¸°" },
      { front: "rice", back: "ìŒ€,ë°¥" },
      { front: "thirsty", back: "ëª©ë§ˆë¥´ë‹¤,ëª©ë§ˆë¥¸" },
      // ì¶”ê°€ ê°€ëŠ¥
    ];

    let current = 0;

    // TTS í•¨ìˆ˜
    function speak(text, lang = "en-US") {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = 0.9;
      utterance.pitch = 1.0;

      const voices = speechSynthesis.getVoices();
      const voice = voices.find(v => v.lang === lang && v.name.includes("Google")) || voices.find(v => v.lang === lang);
      if (voice) utterance.voice = voice;

      speechSynthesis.speak(utterance);
    }

    function updateCard() {
      const cardEl = document.getElementById("card");
      const progressEl = document.getElementById("progress");
      const messageEl = document.getElementById("message");

      if (current < 0) current = 0;
      if (current >= cards.length) current = cards.length - 1;

      const card = cards[current];
      cardEl.textContent = card.front;
      progressEl.textContent = `${current + 1} / ${cards.length}`;
      messageEl.textContent = "";
    }

    function nextCard() {
      current++;
      if (current >= cards.length) current = 0;
      updateCard();
    }

    function prevCard() {
      current--;
      if (current < 0) current = 0;
      updateCard();
    }

    function speakCurrent() {
      speak(cards[current].front, "en-US");
    }

    function startSpeech() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("ìŒì„± ì¸ì‹ì´ ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }

      const recog = new webkitSpeechRecognition();
      recog.lang = "ko-KR";
      recog.interimResults = false;
      recog.maxAlternatives = 1;

      recog.onresult = function(event) {
        const said = event.results[0][0].transcript.trim();
        const correctAnswers = cards[current].back.split(",").map(s => s.trim());
        const isCorrect = correctAnswers.some(ans => said.includes(ans) || ans.includes(said));

        if (isCorrect) {
          showMessage(`âœ… ì •ë‹µ! (${said})`);
        } else {
          showMessage(`âŒ ì˜¤ë‹µ! (${said})<br>ğŸ‘‰ ì •ë‹µ: ${cards[current].back}`);
        }

        setTimeout(() => {
          nextCard();
        }, 1500);
      };

      recog.onerror = function() {
        showMessage("ğŸ¤ ìŒì„± ì¸ì‹ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      };

      recog.start();
      speakCurrent();  // ë§í•˜ê³  ì¸ì‹ ì‹œì‘
    }

    function showMessage(msg) {
      document.getElementById("message").innerHTML = msg;
    }

    // ì´ˆê¸°í™”
    window.onload = () => {
      // TTS ìŒì„± ë¡œë“œ (Chromeì—ì„œ í•„ìˆ˜)
      speechSynthesis.getVoices();
      updateCard();
    };
  </script>

</body>
</html>
